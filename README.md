# jasper
JS development environment for multiple project ASP.NET MVC solution
### Example project layout
```
- MySolution
- - Assets
- - - JS
- - - - Layout
- - - - - app.js
- - - - - bundle
- - - - - - dev.js
- - - - - - (prod.js)
- - - - Modules
- - MyFirstProject
- - - Controllers
- - - - ClassController.cs
- - - Javascript
- - - - Class
- - - - - Admin
- - - - - - app.js
- - - - - - bundle
- - - - - - - dev.js
- - - - - - - (prod.js)
- - - - Shared
- - - - - Layout
- - - - - - bundle
- - - - - - - dev.js
- - - - - - - (prod.js)
- - - Views
- - - - Class
- - - - - Admin.cshtml
- - - - Shared
- - - - - _Layout.cshtml
- - MySecondProject
....

```

### Development

In a command prompt in the project directory, or using 
[Task Runner Explorer](https://visualstudiogallery.msdn.microsoft.com/8e1b4368-4afb-467a-bc13-9650572db708) 
, call `grunt dev`. The task will watch all the `cshtml`, `css` and `dll` files for `livereload`. It will watch all
`js` and `jsx` files in the project and rebuild only that page's JS. For example, if 
`MyFirstProject/Javascript/Class/Admin/app.js` is updated, Grunt will re-bundle the Javascript and then perform a `livereload`.

If you provide `folder` (or `fl`) and `subfolder` (or `sf`) arguments (ex. `grunt dev --fl=Class --sf=Admin`) 
`grunt-contrib-watch`'s [spawn option](https://github.com/gruntjs/grunt-contrib-watch#optionsspawn) will be re-enabled and only that directory will be watched for `js` or `jsx` updates.

### Production

The `(prod.js)` is generated by the `prod` task on your build server. For example, my build server (Jenkins) 
runs `npm install && npm run-script prod` as a pre-build step.

The "Layout" bundle is site-wide JS that is loaded in the `_Layout.cshtml` file. Said file should contain

```
@if (Request.IsLocal)
{
    <script src="http://localhost:35729/livereload.js"></script>
}
<script src="~/Javascript/Shared/Layout/bundle/dev.js"></script>
```

The `prod` task will update this script `src` (along with all the others in other views) to point to `prod.js`. 
So your source code is always in development mode.

### Configuration

* `projects` the list of projects in the solution to include in the production tasks
* `scriptsDir` the project-level Javascript directory (e.g. Javascript, Scripts)
* `globalModulesDir` the directory outside the projects' scopes that contains JS used by multiple projects
* `layoutSrcDir` the directory containing the unbundled JS for `_Layout.cshtml`
* `layoutDestDir` the directory to which to copy bundled JS for `_Layout.cshtml`
* `layoutEntry` the entry point for the unbundled JS for `_Layout.cshtml`
